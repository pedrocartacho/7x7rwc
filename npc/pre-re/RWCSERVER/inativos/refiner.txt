//===== Cronus Script ========================================
//= Refining NPCs
//===== Por: =================================================
//= Syrus22 (1.1) dafide18 (1.4) Skotlex (1.5)
//===== Vers�o Atual: ========================================
//= 2.9b
//===== Coment�rios Adicionais: ==============================
//= 1.0 - by A bunch of people!
//=       Syrus22 - Completely redid the script using functions... also
//=       added the option for auto safe refining and multiple refining.
//= 1.1 - Negative input bug fixed [Lupus]
//= 1.2 - Added additional reparimen in morroc and payon. Added
//=       Christopher the blacksmith in Geffen. Edited some dialogue [kobra_k88]
//= 1.3 - New Payon Locations [Darkchild]
//=       Corrected Zeny subtraction thx to jpnmania77.[kobra_k88]
//= 1.3a - Temporary corrected an exploit. Need to check sources
//=        to fully fix bug [Shinigami]
//=        Fixed repairman prices [shadowlady]
//=        Fixed bug that skips requirements thanks to sir_loon [massdriller]
//=        Fixed itemid error thanks to -Vitamin- [massdriller]
//= 1.4 - check again item in refining procedure to avoid
//=        hacker that can change item [dafide18]
//= 1.5 - Fixed crashing due to badly used callfunc's [Skotlex]
//        Lupus, don't rollback this important fix again! >.<
//= 1.5a - Corrected an unneeded callfunc, fixed the anti-bot 
//=       exploit ruining the safe refine loop. [Skotlex]
//= 1.5b - Fixed Spelling mistakes. [Nexon] 
//= 1.6	- Replaced all breaks for ends as per the new script engine [Skotlex]
//= 1.7 - Added Einbroch Refiners (Custom names ^^;) and a duplicated BS Shop. [Poki#3]
//= 1.8 - Added Lighthalzen Refiners (Custom names again ^^;) [Poki#3]
//= 1.8a - Fixed wrong indication thanks to NeoSaro [Lupus]
//= 1.9 - Rewrote repairman, removed the Steel from repair cost [DracoRPG]
//= 2.0 - Fixed missed equppment presence check. Thx2 Coltaro [Lupus]
//= 2.0a - Added weight checks thanks to Neouni [Playtester]
//= 2.0b - Fixed the names of Lighthalzen and Einbroch refiners thanks to Maud_Dib [Kargha]
//= 2.1 - Removed Duplicates [Silent]
//= 2.2 - Changed name from "Emvertacon" to "Emveretarcon". [Samuray22]
//	- Thanks to Barron-Monster.
//= 2.2b - Changed name from "Pharacon" to "Phracon". [Samuray22]
//	- Thanks to Barron-Monster.
//= 2.3 Corrected NPC names to fall within proper restrictions. [L0ne_W0lf]
//= 2.4 Updated Refiner function. cleaner, and less dated. [L0ne_w0lf]
//= 2.5 Rather large update to the refiner and merchants. :D [L0ne_W0lf]
//= 2.6 Fixed a few bugs with creating pure stones. [L0ne_W0lf]
//= 2.7 Refiner function accepts additional paramater. [L0ne_W0lf]
//=     0 = No special features; 1 = new refining features
//=     Updated Repairmen and function. No longer mess menu.
//= 2.7a A couple touch-ups to the repairman function. [L0ne_w0lf]
//= 2.8 Changed the nonexistent variable .@matname$ for getitemname(.@material). (bugreport:2340) [Samuray22]
//= 2.8 Added proper Blacksmith Supplier to Einroch. [L0ne_W0lf]
//=     Updated dated features comment to reflect new usage.
//= 2.8a Small bugfix. (bugreport:2418) [Paradox924X]
//= 2.9 MOved Morroc repairman to Morroc Ruins. [L0ne_W0lf]
//= 2.9a Traduzido. [The Joker]
//= 2.9b Revisado. [Mara]
//============================================================


//=========================================================
// Christopher: Geffen Blacksmith
//=========================================================
geffen_in,110,172,0	script	Christopher#1rwc	63,{
	mes "[Christopher Guillenrow]";
	mes "Seja bem-vindo � loja do Christopher. Voc� pode achar tudo relacionado a forja aqui. O que traz";
	mes "voc� at� mim?";
	next;
	switch(select("Comprar uma bigorna:Comprar itens de forja:Comprar metais:Purificar min�rios:Cancelar")) {
	case 1:
		mes "[Christopher Guillenrow]";
		mes "Uma boa bigorna aumenta muito as suas chances de se fazer uma boa arma, voc� sabe n�? Mas ir� custar mais Zeny. Escolha a que melhor se encaixa em suas finalidade.";
		next;
		switch(select("Bigorna - 30,000 Zeny:Bigorna de Oridecon - 120,000 Zeny:Bigorna de Ouro - 300,000 Zeny:Uma bigorna melhor que as outras.:Cancelar.")) {
		case 1:
			if (Zeny < 30000) {
				mes "[Christopher Guillenrow]";
				mes "Eu n�o posso vende-la pra voc� se voc� n�o tem o dinheiro. Eu n�o posso perder dinheiro por sua causa.";
				close;
			}
			getitem 986,1; // Anvil
			set Zeny,Zeny-30000;
			mes "[Christopher Guillenrow]";
			mes "Este � um dos mais baratos, mas suficiente para forjar v�rios itens. Obrigado por comprar na minha oficina. Sinta-se livre para voltar a qualquer hora, sempre que precisar.";
			close;
		case 2:
			if (Zeny < 120000) {
				mes "[Christopher Guillenrow]";
				mes "Eu n�o posso vende-la pra voc� se voc� n�o tem o dinheiro. Eu n�o posso perder dinheiro por sua causa.";
				close;
			}
			getitem 987,1; // Oridecon_Anvil
			set Zeny,Zeny-120000;
			mes "[Christopher Guillenrow]";
			mes "Humm, muitos compram essa bigorna. Essa � uma bigorna pr�pria para forjadores, n�o �? Obrigado por comprar na minha oficina. Sinta-se livre para voltar a qualquer hora, sempre que precisar.";
			close;
		case 3:
			if (Zeny < 300000) {
				mes "[Christopher Guillenrow]";
				mes "Eu n�o posso vende-la pra voc� se voc� n�o tem o dinheiro. Eu n�o posso perder dinheiro por sua causa.";
				close;
			}
			getitem 988,1; // Golden_Anvil
			set Zeny,Zeny-300000;
			mes "[Christopher Guillenrow]";
			mes "Essa � a melhor bigorna que eu vendo na minha oficina! Com ela, voc� ir� dominar o mundo da forja! Obrigado por comprar na minha oficina. Sinta-se livre para voltar a qualquer hora, sempre que precisar.";
			close;
		case 4:
			mes "[Christopher Guillenrow]";
			mes "Bem, sinto muito. Mas eu n�o tenha nada melhor que a Bigorna de Ouro.";
			next;
			mes "[Christopher Guillenrow]";
			mes "Eu acho, que o lend�rio criador de bigornas tem uma. Mas, eu n�o acho que voc� possa ach�-lo, embora ele esteja em algum lugar do mundo.";
			close;
		case 5:
			mes "[Christopher Guillenrow]";
			mes "OK, sinta-se a vontade para voltar quando quiser, quando precisar. At� mais.";
			close;
		}
	case 2:
		mes "[Christopher Guillenrow]";
		mes "Um forjador respeit�vel deve usar �timas ferramentas. Voc� pode compr�-las aqui. Escolha qual quer.";
		next;
		switch(select("Mini-Fornalha - 150 Zeny:Martelo de Ferro - 1000 Zeny:Martelo de Ouro - 3000 Zeny:Martelo de Oridecon - 5000 Zeny:Cancelar.")) {
		case 1:
			mes "[Christopher Guillenrow]";
			mes "� uma ferramenta muito �til para se refinar metais! Mas, quantas voc� ir� comprar? Se voc� quiser desistir, basta colocar o n�mero '0.'";
			next;
			while(1) {
				input .@input;
				if (.@input == 0) {
					mes "[Christopher Guillenrow]";
					mes "Bem, a negocia��o foi cancelada. At� mais.";
					close;
				}
				else if ((.@input < 0) || (.@input > 500)) {
					mes "[Christopher Guillenrow]";
					mes "Voc� pode comprar 500, ou menos.";
					next;
				}
				else {
					break;
				}
			}
			set .@sell,.@input * 150;
			if (Zeny < .@sell) {
				mes "[Christopher Guillenrow]";
				mes "Eu n�o posso vende-la pra voc� se voc� n�o tem o dinheiro. Eu n�o posso perder dinheiro por sua causa.";
				close;
			}
			if (checkweight(612,.@input) == 0) {
				mes "[Christopher Guillenrow]";
				mes "Me parece que voc� n�o tem espa�o suficiente no seu invent�rio. Porque voc� n�o coloca seus itens no armaz�m da Kafra?";
				close;
			}
			getitem 612,.@input; // Portable_Furnace
			set Zeny,Zeny-.@sell;
			mes "[Christopher Guillenrow]";
			mes "Obrigado por comprar na minha oficina. Sinta-se livre para vir aqui, sempre que precisar.";
			close;
		case 2:
			if (Zeny < 1000) {
				mes "[Christopher Guillenrow]";
				mes "Eu n�o posso vende-la pra voc� se voc� n�o tem o dinheiro. Eu n�o posso perder dinheiro por sua causa.";
				close;
			}
			getitem 613,1; // Iron_Hammer
			set Zeny,Zeny-1000;
			mes "[Christopher Guillenrow]";
			mes "Obrigado por comprar na minha oficina. Sinta-se livre para vir aqui, sempre que precisar.";
			close;
		case 3:
			if (Zeny < 3000) {
				mes "[Christopher Guillenrow]";
				mes "Eu n�o posso vende-la pra voc� se voc� n�o tem o dinheiro. Eu n�o posso perder dinheiro por sua causa.";
				close;
			}
			getitem 614,1; // Golden_Hammer
			set Zeny,Zeny-3000;
			mes "[Christopher Guillenrow]";
			mes "Obrigado por comprar na minha oficina. Sinta-se livre para vir aqui, sempre que precisar.";
			close;
		case 4:
			if (Zeny < 5000) {
				mes "[Christopher Guillenrow]";
				mes "Eu n�o posso vende-la pra voc� se voc� n�o tem o dinheiro. Eu n�o posso perder dinheiro por sua causa.";
				close;
			}
			getitem 615,1; // Oridecon_Hammer
			set Zeny,Zeny-5000;
			mes "[Christopher Guillenrow]";
			mes "Obrigado por comprar na minha oficina. Sinta-se livre para vir aqui, sempre que precisar.";
			close;
		case 5:
			mes "[Christopher Guillenrow]";
			mes "Volte aqui quando quiser, sempre que precisar. At� mais.";
			close;
		}
	case 3:
		mes "[Christopher Guillenrow]";
		mes "Eu preparo muitos metais, e todos com grande qualidade. Mas ent�o, qual deles voc� precisa?";
		next;
		switch(select("Fracon - 200z.:Emveretarcon - 1000z.:Cancelar.")) {
		case 1:
			mes "[Christopher Guillenrow]";
			mes "Bem, quantos voc� deseja comprar? Se voc� quiser cancelar a negocia��o, basta colocar o n�mero '0.'";
			next;
			while(1) {
				input .@input;
				if (.@input == 0) {
					mes "[Christopher Guillenrow]";
					mes "A negocia��o";
					mes "foi cancelada.";
					mes "At� mais.";
					close;
				}
				else if ((.@input < 0) || (.@input > 500)) {
					mes "[Christopher Guillenrow]";
					mes "Voc� s� pode comprar 500, ou menos.";
					next;
				}
				else {
					break;
				}
			}
			set .@sell,.@input * 200;
			if (Zeny < .@sell) {
				mes "[Christopher Guillenrow]";
				mes "Voc� n�o tem o dinheiro. Voc� sabe que eu n�o posso vender por um baixo pre�o... Minha esposa reclama muito sobre a falta de Zeny.";
				close;
			}
			if (checkweight(1010,.@input) == 0) {
				mes "[Christopher Guillenrow]";
				mes "Me parece que voc� n�o tem espa�o suficiente no seu invent�rio. Porque voc� n�o coloca seus itens no armaz�m da Kafra?";
				close;
			}
			getitem 1010,.@input; // Phracon
			set Zeny,Zeny-.@sell;
			mes "[Christopher Guillenrow]";
			mes "Obrigado por comprar na minha oficina. Sinta-se livre para vir aqui, sempre que precisar.";
			close;
		case 2:
			mes "[Christopher Guillenrow]";
			mes "Bem, quantos voc� deseja comprar? Se voc� quiser cancelar a negocia��o, basta colocar o n�mero '0.'";
			next;
			while(1) {
				input .@input;
				if (.@input == 0) {
					mes "[Christopher Guillenrow]";
					mes "A negocia��o";
					mes "foi cancelada.";
					mes "At� mais.";
					close;
				}
				else if ((.@input < 0) || (.@input > 500)) {
					mes "[Christopher Guillenrow]";
					mes "Voc� s� pode comprar 500, ou menos.";
					next;
				}
				else {
					break;
				}
			}
			set .@sell,.@input * 1000;
			if (Zeny < .@sell) {
				mes "[Christopher Guillenrow]";
				mes "Voc� n�o tem o dinheiro. Voc� sabe que eu n�o posso vender por um baixo pre�o... Minha esposa reclama muito sobre a falta de Zeny.";
				close;
			}
			if (checkweight(1011,.@input) == 0) {
				mes "[Christopher Guillenrow]";
				mes "Meu amigo... Voc� n�o tem espa�o suficiente no invent�rio. Porque n�o guarda algumas coisas no armaz�m da Kafra primeiro?";
				close;
			}
			getitem 1011,.@input; // Emveretarcon
			set Zeny,Zeny-.@sell;
			mes "[Christopher Guillenrow]";
			mes "Obrigado por comprar na minha oficina. Sinta-se livre para vir aqui, sempre que precisar.";
			close;
		case 3:
			mes "[Christopher Guillenrow]";
			mes "Sinta-se livre para voltar, sempre que precisar. At� mais.";
			close;
		}
	case 4:
		mes "[Christopher Guillenrow]";
		mes "Eu posso purificar Oridecons e Eluniuns. Eu crio um metal refinado a partir de 5 metais brutos, seus min�rios. Bem... Qual deles voc� quer fazer?";
		next;
		switch(select("Fazer um Oridecon:Fazer um Elunium:Cancelar.")) {
		case 1:
			if (countitem(756) < 5) {
				mes "[Christopher Guillenrow]";
				mes "Eu lhe disse, eu preciso de 5 Min�rios de Oridecon para fazer um Oridecon.";
				close;
			}
			else {
				delitem 756,5;  //Oridecon_Stone
				getitem 984,1; // Oridecon
				mes "[Christopher Guillenrow]";
				mes "�timo, aqui est� o seu Oridecon. Volte sempre que precisar, espero sua visita.";
				close;
			}
		case 2:
			if (countitem(757) < 5) {
				mes "[Christopher Guillenrow]";
				mes "Eu lhe disse, eu preciso de 5 Min�rios de Eluniuns para fazer um Elunium.";
				close;
			}
			else {
				delitem 757,5;  //Elunium_Stone
				getitem 985,1; // Elunium
				mes "[Christopher Guillenrow]";
				mes "�timo, aqui est� o seu Elunium. Volte sempre que precisar, espero sua visita.";
				close;
			}
		case 3:
			mes "[Christopher Guillenrow]";
			mes "Sinta-se livre para vir aqui, sempre que precisar. At� mais.";
			close;
		}
	case 5:
		mes "[Christopher Guillenrow]";
		mes "Volte sempre, sempre que precisar ou que quiser. At� mais.";
		close;
	}
}

//=========================================================
// Paul Spanner: Einbroch Blacksmith Supplier
//=========================================================
ein_in01,38,29,0	script	Paul Spanner#rwc	63,{
	if (checkweight(1201,1) == 0) {
		mes "- Espere um minuto !! -";
		mes "- Voc� est� carregando -";
		mes "- muitos itens com voc�. -";
		mes "- Por favor volte -";
		mes "- quando voc� estiver mais leve. -";
		close;
	}
	mes "[Paul Spanner]";
	mes "Bem vindo, meu amigo.";
	mes "Na minha oficina, voc� podera encontrar tudo que necessita para forjar.";
	mes "Me diga o que voc� precisa.";
	next;
	switch(select("Comprar uma bigorna.:Comprar itens de forja.:Comprar metais.:Purificar min�rios.:Sair.")) {
	case 1:
		mes "[Paul Spanner]";
		mes "A bigorna � o item mais importante para um forjador.";
		mes "J� que voc� ir� usar v�rias vezes, � melhor voc� compra uma boa.";
		next;
		switch(select("Bigorna - 30,000z.:Bigorna de Oridecon - 120,000z.:Bigorna de Ouro - 300,000z.:Eu quero a melhor bigorna.:Cancelar.")) {
		case 1:
			if (Zeny < 30000) {
				mes "[Paul Spanner]";
				mes "Com esse pouquinho de grana, voc� n�o pode comprar nem uma bigorna de brinquedo!";
				close;
			}
			getitem 986,1; //Anvil
			set Zeny,Zeny-30000;
			mes "[Paul Spanner]";
			mes "� a bigorna mais barata e mais simples que eu tenho aqui.";
			mes "Obrigado por comprar na minha loja. Se voc� precisar de qualquer coisa, n�o se acanhe a me pedir.";
			close;
		case 2:
			if (Zeny < 120000) {
				mes "[Paul Spanner]";
				mes "Com esse pouquinho de grana, voc� n�o pode comprar nem uma bigorna de brinquedo!";
				close;
			}
			getitem 987,1; //Oridecon_Anvil
			set Zeny,Zeny-120000;
			mes "[Paul Spanner]";
			mes "Voc� tem um olho para forja. Um ferreiro precisa de uma boa bigorna pelo menos.";
			mes "Obrigado por comprar na minha loja. Se voc� precisar de qualquer coisa, n�o se acanhe a me pedir.";
			close;
		case 3:
			if (Zeny < 300000) {
				mes "[Paul Spanner]";
				mes "Com esse pouquinho de grana, voc� n�o pode comprar nem uma bigorna de brinquedo!";
				close;
			}
			getitem 988,1; //Golden_Anvil
			set Zeny,Zeny-300000;
			mes "[Paul Spanner]";
			mes "Eu posso dizer que voc� tem ambi��o de se tornar um grande forjador s� por ter comprado essa Bigorna de Ouro!";
			mes "Essa bigorna ir� ajud�-lo a criar as melhores armas.";
			close;
		case 4:
			mes "[Paul Spanner]";
			mes "Me desculpe, mas eu n�o tenho bigornas melhores que a Bigorna de Ouro.";
			mes "A menos que voc� consiga encontrar a lend�ria bigorna de 'Linggell', eu n�o acho que voc� poder� encontrar nada melhor que a Bigorna de Ouro.";
			close;
		case 5:
			mes "[Paul Spanner]";
			mes " Se voc� precisar de algo, basta me dizer.";
			close;
		}
	case 2:
		mes "[Paul Spanner]";
		mes "Voc� precisa de v�rios materiais para forjar itens e purificar metais.";
		mes "Eu tenho tudo que voc� precisa. D� uma olhada.";
		next;
		switch(select("Mini Fornalha - 150z.:Martelo de Ferro - 1,000z.:Martelo de Ouro - 3,000z.:Martelo de Oridecon - 5,000z.:Cancelar.")) {
		case 1:
			set .@item,612;
			set .@item_cost,150;
			set .@item_weight,200;
			mes "[Paul Spanner]";
			mes "Voc� definitivamente precisar� dessa fornalha para purificar os min�rios!";
			next;
			break;
		case 2:
			set .@item,613;
			set .@item_cost,1000;
			set .@item_weight,200;
			break;
		case 3:
			set .@item,614;
			set .@item_cost,3000;
			set .@item_weight,300;
			break;
		case 4:
			set .@item,615;
			set .@item_cost,5000;
			set .@item_weight,400;
			break;
		case 5:
			mes "[Paul Spanner]";
			mes "Se voc� precisar de algo, basta me dizer.";
			close;
		}
		mes "[Paul Spanner]";
		mes "Ent�o, de quantas voc� precisa? Se voc� quiser cancelar a negocia��o, basta colocar '0'.";
		next;
		while(1) {
			input .@input;
			if (.@input == 0) {
				mes "[Paul Spanner]";
				mes "Voc� cancelou a negocia��o. Se voc� precisar de algo, basta me procurar.";
				close;
			}
			else if ((.@input < 0) || (.@input > 500)) {
				mes "[Paul Spanner]";
				mes "Voc� s� pode comprar 500 ou menos por vez.";
				next;
			}
			else {
				break;
			}
		}
		set .@sell,.@input * .@item_cost;
		if (Zeny < .@sell) {
			mes "[Paul Spanner]";
			mes "Voc� n�o possui dinheiro suficiente. Desculpe, eu n�o posso vender por menos.";
			close;
		}
		if (checkweight(.@item,.@input) == 0) {
			mes "[Paul Spanner]";
			mes "Ei, voc� parece p�lido. Alivie seu peso primeiro.";
			close;
		}
		set Zeny,Zeny-.@sell;
		getitem .@item,.@input;
		mes "[Paul Spanner]";
		mes "Obrigado por comprar aqui. Se voc� precisar de algo, basta me dizer.";
		close;
	case 3:
		mes "[Paul Spanner]";
		mes "Eu tenho metais de alta qualidade.";
		mes "Qual tipo de metal voc� quer comprar?";
		next;
		switch(select("Fracon - 200z.:Emveretarcon - 1,000z.:Sair.")) {
		case 1:
			set .@item,1010;
			set .@item_price,200;
			break;
		case 2:
			set .@item,1011;
			set .@item_price,1000;
			break;		
		case 3:
			mes "[Paul Spanner]";
			mes "Se voc� precisar de algo, basta me dizer.";
			close;
		}
		mes "[Paul Spanner]";
		mes "De quantos voc� precisa? Se voc� quiser cancelar a compra, coloque '0'.";
		next;
		while(1) {
			input .@input;
			if (.@input == 0) {
				mes "[Paul Spanner]";
				mes "Voc� cancelou a negocia��o. Se voc� precisar de algo, basta me procurar.";
				close;
			}
			else if ((.@input < 0) || (.@input > 500)) {
				mes "[Paul Spanner]";
				mes "Voc� s� pode comprar 500 ou menos por vez.";
				next;
			}
			else {
				break;
			}
		}
		set .@sell,.@input * .@item_price;
		if (Zeny < .@sell) {
			mes "[Paul Spanner]";
			mes "Voc� n�o possui dinheiro suficiente. Desculpe, eu n�o posso vender por menos.";
			close;
		}
		if (checkweight(.@item,.@input) == 0) {
			mes "[Paul Spanner]";
			mes "Ei, voc� parece p�lido. Por que n�o alivia seu peso primeiro?";
			close;
		}
		getitem .@item,.@input;
		set Zeny,Zeny-.@sell;
		mes "[Paul Spanner]";
		mes "Obrigado por comprar na minha oficina. Se voc� precisar de algo, pode me chamar.";
		close;
	case 4:
		mes "[Paul Spanner]";
		mes "Eu posso purificar Oridecons e Eluniuns para voc�.";
		mes "Voc� precisa de 5 min�rios para purific�-los para Oridecons ou Eluniuns.";
		mes "O que voc� ir� processar?";
		switch(select("Oridecon:Elunium:Sair.")) {
		case 1:
			if (countitem(756) < 5) {
				mes "[Paul Spanner]";
				mes "Voc� precisa de 5 Min�rios de Oridecon para processar por um Oridecon.";
				close;
			}
			else {
				delitem 756,5; //Oridecon_Stone
				getitem 984,1; //Oridecon
				mes "[Paul Spanner]";
				mes "Aqui est�. Obrigado por usar os meus servi�os.";
				close;
			}
		case 2:
			if (countitem(757) < 5) {
				mes "[Paul Spanner]";
				mes "Voc� precisa de 5 Min�rios de Elunium para processar por um Elunium.";
				close;
			}
			else {
				delitem 757,5; //Elunium_Stone
				getitem 985,1; //Elunium
				mes "[Paul Spanner]";
				mes "Aqui est�. Obrigado por usar os meus servi�os.";
				close;
			}
		case 3:
			mes "[Paul Spanner]";
			mes "Se voc� precisar de algo, pode me chamar.";
			close;
		}
	case 5:
		mes "[Paul Spanner]";
		mes "Se voc� precisar de algo, pode me chamar.";
		close;
	}
}

//=====================================================================================
// Weapon/Armor Refiners
//=====================================================================================
izlude,127,112,5	script	Refiner	85,{
	callfunc "refinemain"," ^0000ffBlacksmith^000000 ",1;
	end;
}
//quiz_02,134,354,5	script	Refiner	85,{
//	callfunc "refinemain"," ^0000ffBlacksmith^000000 ",1;
//	end;
//}
//quiz_02,160,354,5	script	Refiner	Red 85,{
//	callfunc "refinemain"," ^0000ffBlacksmith^000000 ",1;
//	end;
//}

//============================================================
//= Main Refiner Function
//============================================================
//= To allow auto safe refining/multiple refining set the
//= second argument to '1' in the function call.
//============================================================
function	script	refinemain	{
	set .@features,getarg(1);
	mes "[" + getarg(0) + "]";
	mes "I'm the Armsmith.";
	mes "I can refine all kinds of weapons, armor and equipment, so let me";
	mes "know what you want me to refine.";
	next;

	setarray .@position$[1], "Acessory","Shoes","Garment","Bottom Head","Middle Head","Shoes","Armor","Shield","Weapon","Acessory";
	set .@menu$,"";
	for( set .@i,1; .@i <= 10; set .@i,.@i+1 )
	{
		if( getequipisequiped(.@i) )
			set .@menu$, .@menu$ + .@position$[.@i] + "-" + "[" + getequipname(.@i) + "]";

		set .@menu$, .@menu$ + ":";
	}
	set .@part,select(.@menu$);
	if(!getequipisequiped(.@part)) {
		mes "[" + getarg(0) + "]";
		mes "You're not wearing";
		mes "anything there that";
		mes "I can refine.";
		emotion 6;
		close;
	}
	//Check if the item is refinable...
	if(!getequipisenableref(.@part)) {
		mes "[" + getarg(0) + "]";
		mes "I don't think I can";
		mes "refine this item at all...";
		close;
	}

	//Check if the item is identified...Don't know why this is in here... but kept it anyway

//	if(!getequipisidentify(.@part)) {
//		mes "[" + getarg(0) + "]";
//		mes "You can't refine this";
//		mes "if you haven't appraised";
//		mes "it first. Make sure your";
//		mes "stuff is identified before";
//		mes "I can refine it.";
//		close;
//	}
	//Check to see if the items is already +10
	if(getequiprefinerycnt(.@part) >= 4) {
		mes "[" + getarg(0) + "]";
		mes "I can't refine this";
		mes "any more. This is as";
		mes "refined as it gets!";
		close;
	}
	set .@refineitemid, getequipid(.@part); // save id of the item
	set .@refinerycnt, getequiprefinerycnt(.@part); //save refinery count
	switch(getequipweaponlv(.@part)){
	case 0: 	//Refine Armor
		set .@safe,4;
		break;
	case 1: 	//Refine Level 1 Weapon
		set .@safe,7; 
		break;
	case 2: 	//Refine Level 2 Weapon
		set .@safe,6; 
		break;
	case 3: 	//Refine Level 3 Weapon
		set .@safe,5; 
		break;
	case 4: 	//Refine Level 4 Weapon
		set .@safe,4; 
		break;
	case 5: 	//Refine other stuff?
		set .@safe,4; 
		break;
	}
	if(.@features != 1) {
		mes "[" + getarg(0) + "]";
		mes "To refine this I need";
		mes "one ^003366"+getitemname(.@material)+"^000000 and";
		mes "a service fee of " + .@price + " Zeny.";
		mes "Do you really wish to continue?";
		next;
		if(select("Yes:No") == 2){
			mes "[" + getarg(0) + "]";
			mes "Yeah...";
			mes "There's no need to";
			mes "rush. Take your time.";
			close;
		}
		if(getequippercentrefinery(.@part) < 100) {
			mes "[" + getarg(0) + "]";
			mes "Oh no! If I continue to";
			mes "refine this, there's a risk it could";
			switch(.@material) {
			case 985:
				mes "be destroyed! That means that ^FF0000this equipment^000000, and ^FF0000any cards^000000 or special properties added to this armor, ^FF0000will be gone^000000.";
				break;
			default:
				mes "be destroyed, and you'd ^FF0000lose the weapon^000000, any ^FF0000cards in the weapon^000000,";
				mes "or any added special properties.";
				break;
			}
			next;
			mes "["+getarg(0)+"]";
			mes "I can't make it any clearer.";
			mes "Once a weapon is destroyed,";	
			mes "there's no getting it back.";
			mes "You really have a chance to";
			mes "^FF0000lose this weapon^000000 forever.";
			mes "Do you still want to refine?";
			next;
			if(select("Yes:No") == 2){
				mes "[" + getarg(0) + "]";
				mes "I completely agree...";
				mes "I might be a great refiner, but sometimes even I make mistakes.";
				close;
			}
		}
		if(getequipisequiped(.@part) == 0) { // hacker has removed the item (not changed, why?)
			mes "[" + getarg(0) + "]";
			mes "Look here... you don't have any Items on...";
			close;
		}
		if(getequiprefinerycnt(.@part) != .@refinerycnt || getequipid(.@part) != .@refineitemid) { // hacker has changed the item
			mes "[" + getarg(0) + "]";
			//emotion e_an;
			mes "Wait a second...";
			mes "Do you think I'm stupid?!";
			mes "You switched the item while I wasn't looking! Get out of here!";
			close;
		}
		if(getequippercentrefinery(.@part) <= rand(100)) {
			failedrefitem .@part;
			mes "[" + getarg(0) + "]";
			set .@emo,rand(1,5);
			if (.@emo == 1) {
				//emotion e_cash;
			} else {
				//emotion e_swt;
			}
			set .@lose,rand(1,3);
			if (.@lose == 1) {
				mes "OH! MY GOD!";
				mes "Damn it! Not again!";
				mes "I'm terribly sorry, but you know practice does make perfect.";
				mes "Um, right? Heh heh...";
			} else if(.@lose == 2) {
				mes "Nooooooo!";
				mes "It broke!";
				mes "I-I'm sorry!";
			} else {
				mes "Crap!";
				mes "It couldn't take";
				mes "much more tempering!";
				mes "Sorry about this...";
			}
			close;
		}
		mes "["+getarg(0)+"]";
		successrefitem .@part;
		//emotion e_heh;
		set .@win,rand(1,3);
		if (.@win == 1) {
			mes "Perfect!";
			mes "Heh heh!";
			mes "Once again,";
			mes "flawless work";
			mes "from the master~";
		} else if(.@win == 2) {
			mes "Success...!";
			mes "Yet again, my amazing";
			mes "talent truly dazzles";
			mes "and shines today.";
		} else {
			mes "Heh heh!";
			mes "I'm all done.";
			mes "No doubt, my work is";
			mes "to your satisfaction.";
			mes "Sheer, utter perfection~";
		}
		close;
	}

// New Refining Functions ========================
	if(getequiprefinerycnt(.@part) < .@safe) {
		mes "[" + getarg(0) + "]";
		mes "I can refine this to the safe limit or a desired number of times... it's your choice...";
		next;
		set .@menu2,select("To the safe limit please.","I've changed my mind...");
	} else set .@menu2,2;
	switch(.@menu2){
	case 1: 
		set .@refinecnt,.@safe - getequiprefinerycnt(.@part);
		break;
	case 2:
		next;
		mes "[" + getarg(0) + "]";
		mes "You said so..Hmm so be it...";
		close;
	}
	if(select("Yes","No...") == 2){
		mes "[" + getarg(0) + "]";
		mes "You said so..Hmm so be it...";
		close;
	}
	while(.@refinecnt){
		if (getequipisequiped(.@part) == 0) {
			mes "[" + getarg(0) + "]";
			mes "Look here... you don't have any Items on...";
			close;
		}
		if (getequipid(.@part) != .@refineitemid || (.@menu2 == 1 && getequippercentrefinery(.@part) < 100)) {
			mes "[" + getarg(0) + "]";
			mes "Clan... No, but Did you imagine I could be so stupid !?!";
			mes "You have changed it...";
			mes "Go out before I stun you with my Hammer!!!";
			close;
		} 
		mes "Clang, clang!!!";
		if(.@menu2 == 2 && getequippercentrefinery(.@part) <= rand(100)) {
			failedrefitem .@part;
			//emotion 23;
			mes "[" + getarg(0) + "]";
			mes "WAHHHH!!! I'm so sorry... I warned you this could happen...";
			set .@refinecnt,.@refinecnt - 1;
			if(.@refinecnt == 0) close;
			mes "Here's the unused Zeny and Material back...";
			getitem .@material,.@refinecnt;
			set .@fullprice,.@refinecnt * .@price;
			set Zeny,Zeny + .@fullprice;
			close;
		}
		successrefitem .@part;
		//emotion 21;
		set .@refinecnt,.@refinecnt - 1;
		next;
	}
	mes "[" + getarg(0) + "]";
	mes "All finished... Come again soon.";
	close;		
}



//==============================================================================
// Material Salesmen
//==============================================================================
prt_in,56,69,4	script	Vurewell#rwc	86,{
	callfunc "phramain","Vurewell";
	end;
}
payon,145,178,4	script	Begnahd#rwc	88,{
	callfunc "phramain","Begnahd";
	end;
}
morocc_in,65,37,4	script	Sade#rwc	99,{
	callfunc "phramain","Sade";
	end;
}
alberta_in,18,59,5	script	Kahlamanlith#rwc	86,{
	callfunc "phramain","Kahlamanlith";
	end;
}
yuno_in01,171,26,6	script	Dillemat#rwc	88,{
	callfunc "phramain","Dillemat";
	end;
}
ein_in01,15,87,7	script	Tirehaus#rwc	86,{
	callfunc "phramain","Tirehaus";
	end;
}
lhz_in02,278,24,3	script	Krugg#rwc	86,{
	callfunc "phramain","Krugg";
	end;
}

//============================================================
//= Material Salesmen Functions
//============================================================
function	script	phramain	{
	if (checkweight(1201,1) == 0) {
		mes "- Espere um minuto !! -";
		mes "- Voc� est� carregando -";
		mes "- muitos itens com voc�. -";
		mes "- Por favor volte -";
		mes "- quando voc� estiver mais leve. -";
		close;
	}
	mes "[" + getarg(0) + "]";
	mes "Eu vendo 2 tipos de metais";
	mes "para temperar armas.";
	mes "Eu tenho ^007777Fracon^000000 para armas de";
	mes "nivel 1, e ^007777Emveretarcon^000000";
	mes "para armas de nivel 2.";
	next;
	switch(select("Fracon - 200 Zeny:Emveretarcon - 1000 Zeny:Perguntar sobre outros metais")) {
	case 1:
		set .@material,1010;
		set .@price,200;
		break;
	case 2:
		set .@material,1011;
		set .@price,1000;
		break;
	case 3:
		mes "[" + getarg(0) + "]";
		mes "Outros metais?";
		mes "Bem, voc� precisa de metais especiais para refinar armas de alto n�vel, ou qualquer tipo de armaduras. Mas como voc� sabe, Oridecon e Elunium s�o realmente";
		mes "dificeis de encontrar...";
		close;
	}
	mes "[" + getarg(0) + "]";
	mes "Quantos voc� quer comprar?";
	mes "Se voc� n�o quiser nenhum, basta colocar o numero, '0.'";
	next;
	while(1) {
		input .@input;
		if (.@input == 0) {
			mes "[" + getarg(0) + "]";
			mes "A negocia��o foi";
			mes "cancelada.";
			close;
		}
		else if (.@input < 0 || .@input > 500) {
			mes "[" + getarg(0) + "]";
			mes "Bem, voc� s� pode";
			mes "comprar 500 por vez.";
			mes "N�o mais do que isso,";
			mes "entendeu? �timo.";
			next;
		}
		else {
			break;
		}
	}
	set .@sell,.@input * .@price;
	if (Zeny < .@sell) {
		mes "[" + getarg(0) + "]";
		mes "Humm...";
		mes "Voc� n�o tem";
		mes "Zeny suficiente para comprar";
		mes ""+ .@input +" destes.";
		close;
	}
	if (checkweight(.@material,.@input) == 0) {
		mes "[" + getarg(0) + "]";
		mes "Hmm...";
		mes "Eu n�o posso te vender nada se voc� n�o tiver espa�o no invent�rio. Porque voc� n�o guarda algumas coisas no armaz�m da Kafra e volta aqui?";
		close;
	}
	getitem .@material,.@input;
	set Zeny,Zeny-.@sell;
	mes "[" + getarg(0) + "]";
	mes "Aqui est�!";
	mes "Muito obrigado pela";
	mes "sua compra, volte sempre.";
	close;
}



//==============================================================================
// Ori/Elu Refiners
//==============================================================================
prt_in,63,69,4	script	Dietrich#rwc	84,{
	callfunc "orimain","Dietrich";
	end;
}
payon,137,178,4	script	Hakhim#rwc	88,{
	callfunc "orimain","Hakhim";
	end;
}
morocc_in,72,32,4	script	Abdul#rwc	99,{
	callfunc "orimain","Abdul";
	end;
}
alberta_in,21,63,5	script	Xenophon#rwc	84,{
	callfunc "orimain","Xenophon";
	end;
}
yuno_in01,171,22,6	script	Delayt#rwc	88,{
	callfunc "orimain","Delayt";
	end;
}
ein_in01,18,82,6	script	Matestein#rwc	84,{
	callfunc "orimain","Matestein";
	end;
}
lhz_in02,281,24,5	script	Fruel#rwc	84,{
	callfunc "orimain","Fruel";
	end;
}

//============================================================
//= Ori/Elu Functions
//============================================================
function	script	orimain	{
	if (checkweight(1201,1) == 0) {
		mes "- Espere um minuto !! -";
		mes "- Voc� est� carregando -";
		mes "- muitos itens com voc�. -";
		mes "- Por favor volte -";
		mes "- quando voc� estiver mais leve. -";
		close;
	}
	mes "[" + getarg(0) + "]";
	mes "Eu posso purificar os seus";
	mes "Min�rios de Oridecon ou";
	mes "Min�rios de Elunium. Eu precisarei de";
	mes "5 min�rios para fazer";
	mes "1 pura para voc�.";
	next;
	switch(select("Fazer Oridecon:Fazer Elunium:Perguntar sobre as pedras encantadas")) {
	case 1:
		if (countitem(756) > 4) {
			delitem 756,5;  //Oridecon_Stone
			getitem 984,1; // Oridecon
			mes "[" + getarg(0) + "]";
			mes "Aqui est� o seu Oridecon.";
			mes "Voc� ser� bem vindo quando";
			mes "voltar aqui novamente.";
			close;
		}
		else {
			mes "[" + getarg(0) + "]";
			mes "Voc� est� brincando comigo, n�o �?";
			mes "Eu disse que preciso de 5 Min�rios de Oridecon para fazer um Oridecon puro.";
			close;
		}
	case 2:
		if (countitem(757) > 4) {
			delitem 757,5;  //Elunium_Stone
			getitem 985,1; // Elunium
			mes "[" + getarg(0) + "]";
			mes "Aqui est� o seu Elunium.";
			mes "Voc� ser� bem vindo quando";
			mes "voltar aqui novamente.";
			close;
		}
		else {
			mes "[" + getarg(0) + "]";
			mes "Voc� est� brincando comigo, n�o �?";
			mes "Eu disse que preciso de 5 Min�rios de Elunium para fazer um Elunium puro.";
			close;
		}
	case 3:
		mes "[" + getarg(0) + "]";
		mes "Pedras encantadas...?";
		mes "Eu fui um forjador de pedras por 20 anos, por isso ouvi muito sobre elas. Supostamente, existem";
		mes "quatro tipos diferentes.";
		next;
		mes "[" + getarg(0) + "]";
		mes "Cada pedra possui uma das seguintes propriedades elementais: Terra, Vento, �gua e Fogo.";
		next;
		mes "[" + getarg(0) + "]";
		mes "Se voc� combinar uma pedra encantada com uma arma enquanto estiver forjando, essa arma ir� possuir a mesma propriedade elemental da pedra que voc� usou.";
		next;
		mes "[" + getarg(0) + "]";
		mes "Devo dizer tamb�m, voc� precisar� de uma alt�ssima habilidade de forja para fazer uma arma elemental.";
		close;
	}
}



//=====================================================================================
// Equipment Repairmen
//=====================================================================================
alberta_in,31,65,4	script	Reparador#alb	86,{
	callfunc "repairmain","Reparador";
	end;
}

moc_ruins,107,94,5	script	Reparador#moc	99,{
	callfunc "repairmain","Reparador";
	end;
}

payon,143,165,4	script	Reparador#pay	88,{
	callfunc "repairmain","Reparador";
	end;
}

prt_in,63,54,2	script	Reparador#prt	86,{
	callfunc "repairmain","Grendal";
	end;
}

yuno_in01,175,28,3	script	Reparador#juno	86,{
	callfunc "repairmain","Reparador";
	end;
}

geffen_in,34,166,3	script	Reparador#gef	99,{
	callfunc "repairmain","Reparador";
	end;
}

aldeba_in,38,60,3	script	Reparador#alde	86,{
	callfunc "repairmain","Reparador";
	end;
}

lhz_in02,284,14,3	script	Reparador#lhz	86,{
	callfunc "repairmain","Reparador";
	end;
}

//============================================================
//= Equipment Repair Function
//============================================================
function	script	repairmain	{
	set .@repairprice,5000;
	mes "["+getarg(0)+"]";
	mes "Ei voc�!";
	mes "Voc� precisa que";
	mes "eu repare algum item?";
	mes "Voc� pode contar comigo";
	mes "para reparar itens!";
	next;
	switch(select("Atualmente, ...:Nenhum no momento.")) {
	case 1:
		set .@checkitem,1;
		while (1) {
			if (getbrokenid(.@checkitem) == 0) {
				break;
			}
			set .@checkitem,.@checkitem+1;
		}
		set .@checkitem,.@checkitem-1;
		if (!.@checkitem) {
			mes "["+getarg(0)+"]";
			mes "Oh, isso � incrivel!";
			mes "Parece que voc� toma muito cuidado com as suas coisas. Nenhum dos seus itens foi danificado!";
			next;
			mes "["+getarg(0)+"]";
			mes "Se todos fossem como voc�, eu estaria desempregado!! Haha~!";
			close;
		}
		mes "["+getarg(0)+"]";
		mes "Hmm...";
		mes "Deixe-me ver...";
		mes "De todos os seus itens,";
		mes "" + .@checkitem + " est�o danificados.";
		mes "Gostaria de repar�-los?";
		next;
		set .@totalcost,.@repairprice*.@checkitem;
		mes "["+getarg(0)+"]";
		mes "Cada reparo custa " + .@repairprice + ". Ent�o para reparar todos os seus itens voc� ir� pagar " + .@totalcost + " Zeny! Voc� quer mesmo reparar os seus itens?";
		next;
		switch(select("Sim:N�o")) {
		case 1:
			if (Zeny < .@totalcost) {
				mes "["+getarg(0)+"]";
				mes "Ei ei...";
				mes "Olhe a sua carteira antes de pedir para repararem um item, cara! Eu n�o posso reparar nada porque voc� n�o possui dinheiro suficiente.";
				close;
			}
			set .@checkitem2,1;
			while (1) {
				if (getbrokenid(.@checkitem2) == 0) {
					break;
				}
				set .@checkitem2,.@checkitem2+1;
			}
			set .@checkitem2,.@checkitem2-1;
			if (.@checkitem == .@checkitem2) {
				set Zeny,Zeny-.@totalcost;
				while (.@checkitem) {
					repair(.@checkitem);
					set .@checkitem,.@checkitem-1;
				}
				mes "["+getarg(0)+"]";
				mes "Okay! Tudo pronto. Agora, tente ter um pouco mais de cuidado. Voc� sabe, itens tem vida tamb�m.";
				close;
			}
			else {
				mes "["+getarg(0)+"]";
				mes "Mmm? Tem algo errado. Espere... Pegue os itens que voc� quer reparar e volte aqui.";
				close;
			}
		case 2:
			mes "["+getarg(0)+"]";
			mes "Bem, n�o � da minha conta, mas n�o � bom levar itens quebrados embora. Voc� deve repar�-los o mais r�pido possivel!";
			close;
		}
	case 2:
		mes "["+getarg(0)+"]";
		mes "Hohoho...";
		mes "Voc� n�o tem";
		mes "nada para fazer aqui";
		mes "se voc� n�o tiver";
		mes "itens para reparar.";
		close;
	}
}
quiz_02,139,353,5	duplicate(Refiner)	Refiner Blue#quiz_02	85
quiz_02,153,353,5	duplicate(Refiner)	Refiner Red#quiz_02	85
//quiz_02,138,357,4	duplicate(Stuff Manage)	Stuff Manage#quiz_02	50
//quiz_02,156,357,4	duplicate(Stuff Manage)	Stuff Manage#quiz_02	50