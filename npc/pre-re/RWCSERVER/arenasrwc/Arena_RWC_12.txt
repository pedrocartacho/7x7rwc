// ==============================================================================
// Arenas 7vs7 modificada inicialmente por rodrigo aka narutekz (2014) e Fissuris (2017) 
// e intensamente aprimorada por Moskaum Y (2024 e 2025)
// ==============================================================================
quiz_02,132,356,5	script	Waiting Room::KvM42R_Guillaume	418,{
	cutin "arena12",4;
	mes "Se você tem se divertido no servidor, demonstre sua apreciaçãoo ^DB6446agora^000000 mesmo fazendo um pix em qualquer quantia que você sente ser proporcional ao entretenimento que você está tendo:";
	mes "^33940CCHAVE PIX xxx^000000";
	next;
	cutin "", 255;
	end;
	
OnInit:
	while (1){
		sleep 2000;
		if (getwaitingroomstate (1) != $@jogadoresbluechat){
			delwaitingroom;
			waitingroom "Arena 12 - 2012rwc_04",$@jogadoresbluechat,"KvM42_BG::OnGuillaumeJoin",1;
			}
	}
	end;
	
OnEnterBG:
	set $@KvM42BG_id1, waitingroom2bg("izlude",128,105,"KvM42_BG::OnGuillaumeQuit","KvM42_BG::OnGuillaumeDie");
	end;
}

quiz_02,163,356,4	script	Waiting Room::KvM42R_Croix	414,{
	cutin "arena12",4;
	mes "Se você tem se divertido no servidor, demonstre sua apreciaçãoo ^DB6446agora^000000 mesmo fazendo um pix em qualquer quantia que você sente ser proporcional ao entretenimento que você está tendo:";
	mes "^33940CCHAVE PIX xxx^000000";
	next;
	cutin "", 255;
	end;

OnInit:
	while (1){
		sleep 2000;
		if (getwaitingroomstate (1) != $@jogadoresredchat){
			delwaitingroom;
			waitingroom "Arena 12 - 2012rwc_04",$@jogadoresredchat,"KvM42_BG::OnCroixJoin",1;
			}
	}
	end;

OnEnterBG:
	set $@KvM42BG_id2, waitingroom2bg("izlude",128,105,"KvM42_BG::OnCroixQuit","KvM42_BG::OnCroixDie");
	end;
}

// Battleground Engine
// *********************************************************************

-	script	KvM42_BG	-1,{
	end;

OnGuillaumeJoin:
OnCroixJoin:
	donpcevent "KvM42_BG::OnReadyCheck";
	end;

OnGuillaumeQuit:
	set BG_Delay_Tick, gettimetick(2) + 2000;
OnGuillaumeDie:
	if( $@KvM42BG == 2 )
	{
		set .Guillaume_Count, .Guillaume_Count - 1;
		set .Croix_Score, .Croix_Score + 1;
		bg_updatescore "2012rwc_04",.Guillaume_Score,.Croix_Score;
		if( .Guillaume_Count < 1 ){
			donpcevent "KvM42_BG::OnCroixWin";
		}
	}
	end;

OnCroixQuit:
	set BG_Delay_Tick, gettimetick(2) + 2000;
OnCroixDie:
	if( $@KvM42BG == 2 )
	{
		set .Croix_Count, .Croix_Count - 1;
		set .Guillaume_Score, .Guillaume_Score + 1;
		bg_updatescore "2012rwc_04",.Guillaume_Score,.Croix_Score;
		if( .Croix_Count < 1 ){
			donpcevent "KvM42_BG::OnGuillaumeWin";
		}
	}
	end;

OnReadyCheck:
	if( $@KvM42BG )
		end;
	set .@Guillaume, getwaitingroomstate(0,"KvM42R_Guillaume");
	set .@Croix, getwaitingroomstate(0,"KvM42R_Croix");

	if((.@Guillaume < $@jogadoresblue) || (.@Croix < $@jogadoresred) )
	{
		if( .@Guillaume > 3 && .@Croix > 3 && !agitcheck() && $@KvM_Flood < gettimetick(2) )
		{
			announce "Arena 12 - 2012rwc_04 | Blue Team: " + .@Guillaume + "/"+$@jogadoresblue+", Red Team: " + .@Croix + "/"+$@jogadoresred+"",0,0xFFA500;
			set $@KvM_Flood, gettimetick(2) + 15;
		}
		else
			mapannounce "quiz_02","Arena 12 - 2012rwc_04 | Blue Team: " + .@Guillaume + "/"+$@jogadoresblue+", Red Team: " + .@Croix + "/"+$@jogadoresred+"",1,0xFFA500;
		end;
	}
		
	if ((.@Guillaume == 0) || (.@Croix == 0)) {
		end;
	}
	
	set $@KvM42BG, 1; // Starting
	donpcevent "KvM42R_Croix::OnEnterBG";
	donpcevent "KvM42R_Guillaume::OnEnterBG";
	donpcevent "KvM42_BG::OnStart";
	end;

OnStart:
	announce "- Duas equipes entraram na [ Arena 12 - 2012rwc_04 ]. -", bc_yellow;
	set $@KvM42BG_Victory, 0;
	// Warp Teams
	bg_warp $@KvM42BG_id1,"2012rwc_04",64,92;
	bg_warp $@KvM42BG_id2,"2012rwc_04",197,91;

	if ($@guildsInArena2 > 0) {
        $@guildsInArena2--;
    }
	if ($@guildsInArena2 > 0) {
        $@guildsInArena2--;
    }

	setwall "2012rwc_04",187,95,8,4,0,"1a";
	setwall "2012rwc_04",187,94,8,4,0,"1b";
	setwall "2012rwc_04",187,93,8,4,0,"1c";
	setwall "2012rwc_04",187,92,8,4,0,"1d";
	setwall "2012rwc_04",187,91,8,4,0,"1e";
	setwall "2012rwc_04",187,90,8,4,0,"1f";
	setwall "2012rwc_04",187,89,8,4,0,"1g";
	setwall "2012rwc_04",187,88,8,4,0,"1h";

	setwall "2012rwc_04",72,95,8,4,0,"2a";
	setwall "2012rwc_04",72,94,8,4,0,"2b";
	setwall "2012rwc_04",72,93,8,4,0,"2c";
	setwall "2012rwc_04",72,92,8,4,0,"2d";
	setwall "2012rwc_04",72,91,8,4,0,"2e";
	setwall "2012rwc_04",72,90,8,4,0,"2f";
	setwall "2012rwc_04",72,89,8,4,0,"2g";
	setwall "2012rwc_04",72,88,8,4,0,"2h";

	sleep 100;
	// ScoreBoard
	
	set .Guillaume_Score, 0;
	set .Croix_Score, 0;
	initnpctimer;
	bg_updatescore "2012rwc_04",.Guillaume_Score,.Croix_Score;
	end;

OnTimer3000:
	mapannounce "2012rwc_04","- The match will begin in 15 seconds! -", bc_yellow;
	end;

OnTimer15000:
	mapannounce "2012rwc_04","- The match will begin in 5 seconds! -", bc_yellow;
	end;

OnTimer16000:
	mapannounce "2012rwc_04","- The match will begin in 4 seconds! -", bc_yellow;
	end;

OnTimer17000:
	mapannounce "2012rwc_04","- The match will begin in 3 seconds! -", bc_yellow;
	end;

OnTimer18000:
	mapannounce "2012rwc_04","- The match will begin in 2 seconds! -", bc_yellow;
	end;
	
OnTimer19000:
	mapannounce "2012rwc_04","- The match will begin in 1 second! -", bc_yellow;
	end;

OnTimer20000:
	// Team Members
	set .Guillaume_Count, bg_get_data($@KvM42BG_id1, 0);
	set .Croix_Count, bg_get_data($@KvM42BG_id2, 0);
	if( (.Guillaume_Count < $@jogadoresblue) || (.Croix_Count < $@jogadoresred) )
	{
		set $@KvM42BG_Victory, 3;
		set $@KvM42BG, 3;
		mapannounce "2012rwc_04","- There are not enough players to start the match. -", bc_yellow;
		stopnpctimer;
		sleep 2000;
		donpcevent "KvM42_BG::OnStop";
		end;
	}

	set $@KvM42BG, 2; // Playing
	delwall "1a";
	delwall "1b";
	delwall "1c";
	delwall "1d";
	delwall "1e";
	delwall "1f";
	delwall "1g";
	delwall "1h";
	delwall "2a";
	delwall "2b";
	delwall "2c";
	delwall "2d";
	delwall "2e";
	delwall "2f";
	delwall "2g";
	delwall "2h";
	end;

OnTimer25001:
	mapannounce "2012rwc_04","- The match started! Good luck to all. -", bc_yellow;
killmonsterall "2012rwc_04";
	end;

OnTimer420000:
	mapannounce "2012rwc_04","- The match will end in 30 seconds! -", bc_yellow;
	end;

OnTimer450000:
	if( .Croix_Count > .Guillaume_Count )
		donpcevent "KvM42_BG::OnCroixWin";
	else if( .Croix_Count < .Guillaume_Count )
		donpcevent "KvM42_BG::OnGuillaumeWin";
	else
	{ // Draw Game
		set $@KvM42BG, 3;
		set $@KvM42BG_Victory, 3;

		stopnpctimer;
		sleep 2000;
		announce "- As duas equipes empataram! -", bc_yellow;
		donpcevent "KvM42_BG::OnStop";
	}
	end;

OnGuillaumeWin:
	set $@KvM42BG, 3;
	set $@KvM42BG_Victory, 1;

	stopnpctimer;
	sleep 1000;	
	announce "- Blue Team VENCEU! -",bc_all,0x00bfff;
	sleep 3000;
	donpcevent "KvM42_BG::OnStop";
	end;

OnCroixWin:
	set $@KvM42BG, 3;
	set $@KvM42BG_Victory, 2;

	stopnpctimer;
	sleep 1000;
	announce "- Red Team VENCEU! -",bc_all,0xff6347;
	sleep 3000;
	donpcevent "KvM42_BG::OnStop";
	end;

OnStop:
	if ($spectator_count12 > 0) {
       set $spectator_count12, $spectator_count12 - 1;
    }
	if ($spectator_count12 > 0) {
       set $spectator_count12, $spectator_count12 - 1;
    }
	// Warp Teams
	mapwarp "2012rwc_04","izlude",128,105;
	donpcevent "KvM42_BG_Out::OnBegin";
	end;

OnReset:
	stopnpctimer;
	stopnpctimer "KvM42_BG_Out";
	set .Croix_Count, 0;
	set .Guillaume_Count, 0;
	set .Croix_Score, 0;
	set .Guillaume_Score, 0;
	set $@KvM42BG_Victory, 0;
	if( $@KvM42BG_id1 ) { bg_destroy $@KvM42BG_id1; set $@KvM42BG_id1, 0; }
	if( $@KvM42BG_id2 ) { bg_destroy $@KvM42BG_id2; set $@KvM42BG_id2, 0; }
	sleep 2000;
	mapwarp "2012rwc_04","izlude",128,105;
	sleep 2000;
	maprespawnguildid "2012rwc_04",0,3; // Just in case someone else
	bg_updatescore "2012rwc_04",0,0;
	sleep 2000;
	set $@KvM42BG, 0;
	donpcevent "KvM42_BG::OnReadyCheck"; // Maybe a game is ready to start
	end;
}

-	script	KvM42_BG_Out	-1,{
	end;

OnBegin:
	initnpctimer;
	end;

OnTimer50000:
	mapannounce "2012rwc_04","- The match will end in 10 seconds! -",1,0x696969;
	end;
OnTimer3000:
	donpcevent "KvM42_BG::OnReset";
	end;
}